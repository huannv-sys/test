{% extends "base.html" %}

{% block title %}Cài đặt hệ thống - MikroTik Monitor{% endblock %}

{% block extra_css %}
<style>
    .nav-settings {
        border-right: 1px solid #dee2e6;
    }
    
    .nav-settings .nav-link {
        color: #495057;
        border-radius: 0;
        padding: 0.8rem 1rem;
    }
    
    .nav-settings .nav-link.active {
        color: #0d6efd;
        background-color: #f8f9fa;
        border-left: 3px solid #0d6efd;
    }
    
    .nav-settings .nav-link:hover:not(.active) {
        background-color: #f1f1f1;
    }
    
    .settings-icon {
        width: 22px;
        text-align: center;
        margin-right: 10px;
    }
    
    @media (max-width: 767.98px) {
        .nav-settings {
            border-right: none;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        .nav-settings .nav-link {
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .nav-settings .nav-link.active {
            border-left: none;
            border-bottom: 3px solid #0d6efd;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h3"><i class="fas fa-cog"></i> Cài đặt hệ thống</h2>
    </div>

    <div class="row">
        <!-- Settings Navigation -->
        <div class="col-md-3 mb-4">
            <div class="card shadow h-100">
                <div class="card-body p-0">
                    <nav class="nav flex-column nav-settings">
                        <a class="nav-link active" id="general-tab" data-bs-toggle="pill" href="#general">
                            <span class="settings-icon"><i class="fas fa-sliders-h"></i></span> Tổng quan
                        </a>
                        <a class="nav-link" id="monitoring-tab" data-bs-toggle="pill" href="#monitoring">
                            <span class="settings-icon"><i class="fas fa-chart-line"></i></span> Giám sát
                        </a>
                        <a class="nav-link" id="notifications-tab" data-bs-toggle="pill" href="#notifications">
                            <span class="settings-icon"><i class="fas fa-bell"></i></span> Thông báo
                        </a>
                        <a class="nav-link" id="email-tab" data-bs-toggle="pill" href="#email">
                            <span class="settings-icon"><i class="fas fa-envelope"></i></span> Email
                        </a>
                        <a class="nav-link" id="telegram-tab" data-bs-toggle="pill" href="#telegram">
                            <span class="settings-icon"><i class="fab fa-telegram-plane"></i></span> Telegram
                        </a>
                        <a class="nav-link" id="backup-tab" data-bs-toggle="pill" href="#backup">
                            <span class="settings-icon"><i class="fas fa-save"></i></span> Sao lưu
                        </a>
                        <a class="nav-link" id="advanced-tab" data-bs-toggle="pill" href="#advanced">
                            <span class="settings-icon"><i class="fas fa-tools"></i></span> Nâng cao
                        </a>
                        <a class="nav-link" id="license-tab" data-bs-toggle="pill" href="#license">
                            <span class="settings-icon"><i class="fas fa-key"></i></span> Giấy phép
                        </a>
                        <a class="nav-link" id="about-tab" data-bs-toggle="pill" href="#about">
                            <span class="settings-icon"><i class="fas fa-info-circle"></i></span> Giới thiệu
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Settings Content -->
        <div class="col-md-9">
            <div class="card shadow">
                <div class="card-body">
                    <div class="tab-content">
                        <!-- General Settings -->
                        <div class="tab-pane fade show active" id="general">
                            <h5 class="mb-4">Cài đặt tổng quan</h5>
                            <form id="generalSettingsForm">
                                <div class="mb-3">
                                    <label for="appName" class="form-label">Tên ứng dụng</label>
                                    <input type="text" class="form-control" id="appName" value="MikroTik Monitor">
                                </div>
                                <div class="mb-3">
                                    <label for="appURL" class="form-label">URL ứng dụng</label>
                                    <input type="url" class="form-control" id="appURL" placeholder="https://yourserver.com">
                                    <small class="form-text text-muted">URL cơ sở cho các liên kết trong email và thông báo</small>
                                </div>
                                <div class="mb-3">
                                    <label for="timeZone" class="form-label">Múi giờ</label>
                                    <select class="form-select" id="timeZone">
                                        <option value="UTC">UTC</option>
                                        <option value="Asia/Ho_Chi_Minh" selected>Asia/Ho_Chi_Minh (GMT+7)</option>
                                        <option value="Asia/Bangkok">Asia/Bangkok (GMT+7)</option>
                                        <option value="Asia/Singapore">Asia/Singapore (GMT+8)</option>
                                        <option value="Asia/Tokyo">Asia/Tokyo (GMT+9)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="dateFormat" class="form-label">Định dạng ngày</label>
                                    <select class="form-select" id="dateFormat">
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                        <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="language" class="form-label">Ngôn ngữ</label>
                                    <select class="form-select" id="language">
                                        <option value="en">English</option>
                                        <option value="vi" selected>Tiếng Việt</option>
                                    </select>
                                </div>
                                <button type="button" class="btn btn-primary" id="saveGeneralSettingsBtn">Lưu thay đổi</button>
                            </form>
                        </div>
                        
                        <!-- Monitoring Settings -->
                        <div class="tab-pane fade" id="monitoring">
                            <h5 class="mb-4">Cài đặt giám sát</h5>
                            <form id="monitoringSettingsForm">
                                <div class="mb-3">
                                    <label for="monitoringInterval" class="form-label">Khoảng thời gian giám sát (giây)</label>
                                    <input type="number" class="form-control" id="monitoringInterval" value="300" min="30">
                                    <small class="form-text text-muted">Khoảng thời gian tối thiểu là 30 giây</small>
                                </div>
                                <div class="mb-3">
                                    <label for="alertCheckInterval" class="form-label">Khoảng thời gian kiểm tra cảnh báo (giây)</label>
                                    <input type="number" class="form-control" id="alertCheckInterval" value="60" min="30">
                                </div>
                                <div class="mb-3">
                                    <label for="dataRetention" class="form-label">Lưu trữ dữ liệu (ngày)</label>
                                    <input type="number" class="form-control" id="dataRetention" value="30" min="1">
                                    <small class="form-text text-muted">Thời gian lưu trữ dữ liệu metrics</small>
                                </div>
                                <div class="mb-3">
                                    <label for="highResolutionData" class="form-label">Khoảng thời gian dữ liệu độ phân giải cao (phút)</label>
                                    <select class="form-select" id="highResolutionData">
                                        <option value="1">1 phút</option>
                                        <option value="5" selected>5 phút</option>
                                        <option value="10">10 phút</option>
                                        <option value="15">15 phút</option>
                                        <option value="30">30 phút</option>
                                    </select>
                                    <small class="form-text text-muted">Khoảng thời gian cho dữ liệu chi tiết (thời gian càng ngắn càng tốn tài nguyên)</small>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableProxy" checked>
                                    <label class="form-check-label" for="enableProxy">Tự động phát hiện proxy</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableClientMonitoring" checked>
                                    <label class="form-check-label" for="enableClientMonitoring">Giám sát clients kết nối</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableAutoDiscover">
                                    <label class="form-check-label" for="enableAutoDiscover">Tự động tìm kiếm thiết bị mới</label>
                                </div>
                                <button type="button" class="btn btn-primary" id="saveMonitoringSettingsBtn">Lưu thay đổi</button>
                            </form>
                        </div>
                        
                        <!-- Notification Settings -->
                        <div class="tab-pane fade" id="notifications">
                            <h5 class="mb-4">Thiết lập thông báo</h5>
                            <form id="notificationSettingsForm">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableNotifications" checked>
                                    <label class="form-check-label" for="enableNotifications">Bật thông báo</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableEmailAlerts" checked>
                                    <label class="form-check-label" for="enableEmailAlerts">Gửi cảnh báo qua email</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableTelegramAlerts">
                                    <label class="form-check-label" for="enableTelegramAlerts">Gửi cảnh báo qua Telegram</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableSystemTray">
                                    <label class="form-check-label" for="enableSystemTray">Hiện thông báo trên system tray</label>
                                </div>
                                <div class="mb-3">
                                    <label for="notificationCooldown" class="form-label">Thời gian chờ giữa các thông báo (phút)</label>
                                    <input type="number" class="form-control" id="notificationCooldown" value="15" min="1">
                                </div>
                                <button type="button" class="btn btn-primary" id="saveNotificationsBtn">Lưu thay đổi</button>
                            </form>
                        </div>
                        
                        <!-- Email Settings -->
                        <div class="tab-pane fade" id="email">
                            <h5 class="mb-4">Cấu hình email</h5>
                            <form id="emailSettingsForm">
                                <div class="mb-3">
                                    <label for="smtpServer" class="form-label">Máy chủ SMTP</label>
                                    <input type="text" class="form-control" id="smtpServer" placeholder="smtp.gmail.com">
                                </div>
                                <div class="mb-3">
                                    <label for="smtpPort" class="form-label">Cổng SMTP</label>
                                    <input type="number" class="form-control" id="smtpPort" value="587">
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="smtpUseTLS" checked>
                                    <label class="form-check-label" for="smtpUseTLS">Sử dụng TLS</label>
                                </div>
                                <div class="mb-3">
                                    <label for="smtpUsername" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="smtpUsername" placeholder="your-email@gmail.com">
                                </div>
                                <div class="mb-3">
                                    <label for="smtpPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="smtpPassword">
                                </div>
                                <div class="mb-3">
                                    <label for="emailFrom" class="form-label">Email người gửi</label>
                                    <input type="email" class="form-control" id="emailFrom" placeholder="your-email@gmail.com">
                                </div>
                                <div class="mb-3">
                                    <label for="emailRecipients" class="form-label">Người nhận cảnh báo</label>
                                    <textarea class="form-control" id="emailRecipients" rows="2" placeholder="email1@example.com, email2@example.com"></textarea>
                                    <small class="form-text text-muted">Danh sách email cách nhau bởi dấu phẩy</small>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-primary" id="saveEmailSettingsBtn">Lưu thay đổi</button>
                                    <button type="button" class="btn btn-outline-secondary" id="testEmailBtn">Gửi email thử</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Telegram Settings -->
                        <div class="tab-pane fade" id="telegram">
                            <h5 class="mb-4">Cấu hình Telegram</h5>
                            <form id="telegramSettingsForm">
                                <div class="mb-3">
                                    <label for="telegramBotToken" class="form-label">Bot Token</label>
                                    <input type="text" class="form-control" id="telegramBotToken">
                                    <small class="form-text text-muted">Token của bot Telegram, lấy từ <a href="https://t.me/BotFather" target="_blank">BotFather</a></small>
                                </div>
                                <div class="mb-3">
                                    <label for="telegramChatId" class="form-label">Chat ID</label>
                                    <input type="text" class="form-control" id="telegramChatId">
                                    <small class="form-text text-muted">ID của người dùng hoặc nhóm sẽ nhận thông báo</small>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="telegramSendSystemAlerts" checked>
                                    <label class="form-check-label" for="telegramSendSystemAlerts">Gửi cảnh báo hệ thống</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="telegramSendDeviceAlerts" checked>
                                    <label class="form-check-label" for="telegramSendDeviceAlerts">Gửi cảnh báo thiết bị</label>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-primary" id="saveTelegramSettingsBtn">Lưu thay đổi</button>
                                    <button type="button" class="btn btn-outline-secondary" id="testTelegramBtn">Gửi thử</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Backup Settings -->
                        <div class="tab-pane fade" id="backup">
                            <h5 class="mb-4">Cài đặt sao lưu</h5>
                            <form id="backupSettingsForm">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableAutomaticBackups" checked>
                                    <label class="form-check-label" for="enableAutomaticBackups">Tự động sao lưu thiết bị</label>
                                </div>
                                <div class="mb-3">
                                    <label for="backupSchedule" class="form-label">Lịch sao lưu</label>
                                    <select class="form-select" id="backupSchedule">
                                        <option value="daily">Hàng ngày</option>
                                        <option value="weekly" selected>Hàng tuần</option>
                                        <option value="monthly">Hàng tháng</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="backupRetention" class="form-label">Thời gian lưu trữ bản sao lưu (ngày)</label>
                                    <input type="number" class="form-control" id="backupRetention" value="90" min="1">
                                </div>
                                <div class="mb-3">
                                    <label for="backupTime" class="form-label">Thời gian sao lưu</label>
                                    <input type="time" class="form-control" id="backupTime" value="02:00">
                                    <small class="form-text text-muted">Thời gian sao lưu theo giờ hệ thống</small>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="compressBackups" checked>
                                    <label class="form-check-label" for="compressBackups">Nén bản sao lưu</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="encryptBackups" checked>
                                    <label class="form-check-label" for="encryptBackups">Mã hóa bản sao lưu</label>
                                </div>
                                <div class="mb-3">
                                    <label for="backupLocation" class="form-label">Đường dẫn lưu trữ</label>
                                    <input type="text" class="form-control" id="backupLocation" value="backups">
                                </div>
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-primary" id="saveBackupSettingsBtn">Lưu thay đổi</button>
                                    <button type="button" class="btn btn-outline-secondary" id="runBackupNowBtn">Sao lưu ngay</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Advanced Settings -->
                        <div class="tab-pane fade" id="advanced">
                            <h5 class="mb-4">Cài đặt nâng cao</h5>
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i> Cảnh báo: Thay đổi các cài đặt này có thể ảnh hưởng đến hiệu suất và hoạt động của ứng dụng.
                            </div>
                            <form id="advancedSettingsForm">
                                <div class="mb-3">
                                    <label for="logLevel" class="form-label">Mức độ ghi log</label>
                                    <select class="form-select" id="logLevel">
                                        <option value="DEBUG">Debug</option>
                                        <option value="INFO" selected>Info</option>
                                        <option value="WARNING">Warning</option>
                                        <option value="ERROR">Error</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="apiTimeout" class="form-label">Timeout kết nối API (giây)</label>
                                    <input type="number" class="form-control" id="apiTimeout" value="10" min="1">
                                </div>
                                <div class="mb-3">
                                    <label for="maxConnections" class="form-label">Số kết nối đồng thời tối đa</label>
                                    <input type="number" class="form-control" id="maxConnections" value="5" min="1">
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableAPICache" checked>
                                    <label class="form-check-label" for="enableAPICache">Bật cache API</label>
                                </div>
                                <div class="mb-3">
                                    <label for="cacheTTL" class="form-label">Thời gian cache (giây)</label>
                                    <input type="number" class="form-control" id="cacheTTL" value="60" min="0">
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableDebugMode">
                                    <label class="form-check-label" for="enableDebugMode">Chế độ debug</label>
                                </div>
                                <button type="button" class="btn btn-primary" id="saveAdvancedSettingsBtn">Lưu thay đổi</button>
                            </form>
                            <hr>
                            <h6 class="mt-4 mb-3">Thao tác bảo trì</h6>
                            <div class="d-flex gap-2 mb-3">
                                <button type="button" class="btn btn-warning" id="clearCacheBtn">
                                    <i class="fas fa-broom"></i> Xóa cache
                                </button>
                                <button type="button" class="btn btn-warning" id="optimizeDatabaseBtn">
                                    <i class="fas fa-database"></i> Tối ưu database
                                </button>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-danger" id="resetSettingsBtn">
                                    <i class="fas fa-undo"></i> Khôi phục cài đặt mặc định
                                </button>
                                <button type="button" class="btn btn-danger" id="purgeDataBtn">
                                    <i class="fas fa-trash-alt"></i> Xóa tất cả dữ liệu
                                </button>
                            </div>
                        </div>
                        
                        <!-- License Settings -->
                        <div class="tab-pane fade" id="license">
                            <h5 class="mb-4">Thông tin giấy phép</h5>
                            <div class="card border-light mb-4">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">MikroTik Monitor</h6>
                                            <p class="text-muted mb-0">Phiên bản: 1.0.0</p>
                                        </div>
                                        <span class="badge bg-success px-3 py-2">Free</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Nâng cấp lên Pro</h6>
                                </div>
                                <div class="card-body">
                                    <p>Nâng cấp lên phiên bản Pro để mở khóa:</p>
                                    <ul class="mb-3">
                                        <li>Giám sát không giới hạn thiết bị</li>
                                        <li>Topology mạng 3D nâng cao</li>
                                        <li>Thông báo qua SMS và các nền tảng khác</li>
                                        <li>Báo cáo PDF tùy chỉnh</li>
                                        <li>Tích hợp với các hệ thống giám sát khác</li>
                                    </ul>
                                    <div class="d-grid">
                                        <button class="btn btn-primary" id="upgradeToPro">
                                            <i class="fas fa-crown"></i> Nâng cấp Pro - 499.000đ / năm
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Mã kích hoạt</h6>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i> Nhập mã kích hoạt để nâng cấp lên phiên bản Pro.
                                    </div>
                                    <form id="licenseForm">
                                        <div class="mb-3">
                                            <label for="licenseKey" class="form-label">Mã kích hoạt</label>
                                            <input type="text" class="form-control" id="licenseKey" placeholder="XXXX-XXXX-XXXX-XXXX">
                                        </div>
                                        <button type="button" class="btn btn-primary" id="activateLicense">Kích hoạt</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- About -->
                        <div class="tab-pane fade" id="about">
                            <h5 class="mb-4">Thông tin ứng dụng</h5>
                            <div class="text-center mb-4">
                                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="MikroTik Monitor Logo" class="img-fluid" style="max-width: 200px;">
                                <h4 class="mt-3">MikroTik Monitor</h4>
                                <p class="text-muted">Phiên bản 1.0.0</p>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h6>Thông tin hệ thống</h6>
                                    <table class="table table-striped">
                                        <tbody>
                                            <tr>
                                                <th>Phiên bản Python:</th>
                                                <td id="pythonVersion">{{ python_version }}</td>
                                            </tr>
                                            <tr>
                                                <th>Phiên bản Flask:</th>
                                                <td id="flaskVersion">{{ flask_version }}</td>
                                            </tr>
                                            <tr>
                                                <th>OS:</th>
                                                <td id="osVersion">{{ os_info }}</td>
                                            </tr>
                                            <tr>
                                                <th>Database:</th>
                                                <td id="databaseInfo">{{ db_info }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Thống kê</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 col-6 mb-3">
                                            <div class="d-flex flex-column">
                                                <span class="h3">{{ stats.devices }}</span>
                                                <span class="text-muted">Thiết bị</span>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3">
                                            <div class="d-flex flex-column">
                                                <span class="h3">{{ stats.metrics }}</span>
                                                <span class="text-muted">Metrics</span>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3">
                                            <div class="d-flex flex-column">
                                                <span class="h3">{{ stats.alerts }}</span>
                                                <span class="text-muted">Cảnh báo</span>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-6 mb-3">
                                            <div class="d-flex flex-column">
                                                <span class="h3">{{ stats.users }}</span>
                                                <span class="text-muted">Người dùng</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Giấy phép mã nguồn mở</h6>
                                </div>
                                <div class="card-body">
                                    <p>MikroTik Monitor sử dụng các thư viện mã nguồn mở sau:</p>
                                    <ul class="mb-0">
                                        <li>Flask - <a href="https://flask.palletsprojects.com/" target="_blank">https://flask.palletsprojects.com/</a></li>
                                        <li>SQLAlchemy - <a href="https://www.sqlalchemy.org/" target="_blank">https://www.sqlalchemy.org/</a></li>
                                        <li>Bootstrap - <a href="https://getbootstrap.com/" target="_blank">https://getbootstrap.com/</a></li>
                                        <li>Chart.js - <a href="https://www.chartjs.org/" target="_blank">https://www.chartjs.org/</a></li>
                                        <li>D3.js - <a href="https://d3js.org/" target="_blank">https://d3js.org/</a></li>
                                        <li>Three.js - <a href="https://threejs.org/" target="_blank">https://threejs.org/</a></li>
                                        <li>Socket.IO - <a href="https://socket.io/" target="_blank">https://socket.io/</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Test Email Modal -->
<div class="modal fade" id="testEmailModal" tabindex="-1" aria-labelledby="testEmailModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="testEmailModalLabel">Gửi email thử</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="testEmailAddress" class="form-label">Địa chỉ email</label>
                    <input type="email" class="form-control" id="testEmailAddress" placeholder="your-email@example.com">
                </div>
                <div id="emailTestStatus"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="sendTestEmailBtn">Gửi email</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Reset Modal -->
<div class="modal fade" id="confirmResetModal" tabindex="-1" aria-labelledby="confirmResetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmResetModalLabel">Xác nhận khôi phục</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i> Cảnh báo: Hành động này sẽ thiết lập lại tất cả cài đặt về mặc định.
                </div>
                <p>Bạn có chắc chắn muốn tiếp tục?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmResetBtn">Tiếp tục</button>
            </div>
        </div>
    </div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paymentModalLabel">Nâng cấp lên phiên bản Pro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-crown fa-4x text-warning mb-3"></i>
                    <h5>MikroTik Monitor Pro</h5>
                    <p>Trải nghiệm đầy đủ tính năng cao cấp</p>
                </div>
                
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="text-center mb-3">Tính năng Pro</h6>
                        <ul class="mb-0">
                            <li>Giám sát không giới hạn thiết bị</li>
                            <li>Topology mạng 3D nâng cao</li>
                            <li>Thông báo qua SMS và các nền tảng khác</li>
                            <li>Báo cáo PDF tùy chỉnh</li>
                            <li>Tích hợp với các hệ thống giám sát khác</li>
                            <li>Hỗ trợ kỹ thuật ưu tiên</li>
                        </ul>
                    </div>
                </div>
                
                <div class="text-center mb-3">
                    <h5>499.000đ / năm</h5>
                    <p class="text-muted">(Tương đương 41.500đ / tháng)</p>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="proceedToPaymentBtn">
                    <i class="fas fa-lock"></i> Thanh toán an toàn
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize settings page
        initializeSettings();
        
        // Test email button
        document.getElementById('testEmailBtn').addEventListener('click', function() {
            $('#testEmailModal').modal('show');
        });
        
        // Reset settings button
        document.getElementById('resetSettingsBtn').addEventListener('click', function() {
            $('#confirmResetModal').modal('show');
        });
        
        // Upgrade to Pro button
        document.getElementById('upgradeToPro').addEventListener('click', function() {
            $('#paymentModal').modal('show');
        });
        
        // Proceed to payment button
        document.getElementById('proceedToPaymentBtn').addEventListener('click', function() {
            // Call the payment API endpoint
            fetch('/api/payments/create-checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    plan: 'pro',
                    period: 'yearly'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.url) {
                    window.location.href = data.url;
                } else {
                    showError('Không thể tạo phiên thanh toán');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showError('Lỗi khi tạo phiên thanh toán');
            });
        });
    });
</script>
{% endblock %}